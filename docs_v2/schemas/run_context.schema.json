{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://arcanomy.dev/schemas/run_context.schema.json",
  "title": "RunContext",
  "type": "object",
  "additionalProperties": false,
  "required": ["schema_version", "run_id", "created_at", "blog", "ledger", "libraries"],
  "properties": {
    "schema_version": { "type": "string", "const": "1.0" },
    "run_id": { "type": "string", "minLength": 5 },
    "created_at": { "type": "string", "format": "date-time" },
    "blog": {
      "type": "object",
      "additionalProperties": false,
      "required": ["identifier", "slug", "hash"],
      "properties": {
        "identifier": { "type": "string" },
        "slug": { "type": "string" },
        "hash": { "type": "string", "minLength": 8 },
        "version": { "type": "string" }
      }
    },
    "ledger": {
      "type": "object",
      "additionalProperties": false,
      "required": ["source", "query"],
      "properties": {
        "source": { "type": "string", "enum": ["supabase", "file"] },
        "query": {
          "type": "object",
          "additionalProperties": false,
          "required": ["blog_slug", "recent_days"],
          "properties": {
            "blog_slug": { "type": "string" },
            "recent_days": { "type": "integer", "minimum": 1, "maximum": 365 }
          }
        }
      }
    },
    "libraries": {
      "type": "object",
      "additionalProperties": false,
      "required": ["broll_index_hash", "music_index_hash"],
      "properties": {
        "broll_index_hash": { "type": "string", "minLength": 8 },
        "music_index_hash": { "type": "string", "minLength": 8 }
      }
    }
  }
}

